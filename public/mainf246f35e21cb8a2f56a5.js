(()=>{"use strict";const t=async(t="GET",e,n,a=null)=>{const o=await fetch(e,{method:t,headers:{"Content-Type":"application/json"},body:n?JSON.stringify(n):null});if(500==o.status)throw new Error(a);return o.json()},e=document.querySelector("#updateCar"),n=document.querySelector("#updateColorCar"),a=document.querySelector("#updateCarBtn"),o=(e,n,a)=>{t("PATCH",`http://127.0.0.1:3000/engine?id=${e}&status=stopped`,null).then((t=>{const o=document.querySelector(`#car${e}`);n&&(o.style=`\n             animation-play-state: paused !important;\n             color:${a}\n            `)}))};function c(t,e,n){console.log(t,n);const{velocity:a,distance:o}=t,c=Math.round(o/a/1e3);document.querySelector(`#car${e}`).style=`\n        animation: runcar ${c}s linear forwards;\n        animation-play-state: running;\n        color: ${n}\n       `}const r=document.getElementById("cars-list"),l=()=>{t("GET","http://127.0.0.1:3000/garage",null).then((s=>{(s=>{const i=[];r.innerHTML="",s.forEach((t=>{const{color:e,id:n,name:a}=t;i.push(e),r.innerHTML+=`\n        <li class="list-group-item">\n        <div class="car-buttons mb-5 d-flex justify-content-between">\n            <div>\n                <button id="${n}"  class="btn btn-primary btn-sm start-btn">Start</button>\n                <button id="${n}" class="btn btn-primary btn-sm stop-btn">Stop</button>\n                <button id="${n}" class="btn btn-primary btn-sm select-btn">Select</button>\n                <button id="${n}" class="btn btn-danger btn-sm delete-btn">\n                  <i class="fas fa-trash"></i>\n                </button>\n            </div>\n            <span>${a}</span>\n        </div>\n        <div class="w-100  d-flex">\n            <i id="car${n}" style="color:${e}" class="fa-solid fa-car-side position-absolute fa-2xl car-icon"></i>\n            <div style="width: 100%; background-color: red; height: 2px; margin-top: 15px;"></div>\n            <i  class="fa-solid fa-flag fa-2xl"></i>\n        </div>\n    </li>\n        `})),document.querySelectorAll(".select-btn").forEach((o=>{o.addEventListener("click",(()=>{var c;c=o.getAttribute("id"),t("GET",`http://127.0.0.1:3000/garage/${c}`,null).then((t=>{const{name:a,color:o,id:c}=t;e.value=a,n.value=o})),a.addEventListener("click",(()=>{const a=e.value,o=n.value;t("PUT",`http://127.0.0.1:3000/garage/${c}`,{name:a,color:o}).then((t=>{l()}))}))}))})),document.querySelectorAll(".start-btn").forEach(((e,n)=>{e.addEventListener("click",(()=>{var a,o;a=e.getAttribute("id"),o=i[n],console.log(a),t("PATCH",`http://127.0.0.1:3000/engine?id=${a}&status=started`,null).then((t=>{c(t,a,o)}))}))})),document.querySelectorAll(".delete-btn").forEach((e=>{e.addEventListener("click",(()=>{var n;n=e.getAttribute("id"),t("DELETE",`http://127.0.0.1:3000/garage/${n}`,null).then((t=>{l()}))}))})),document.querySelectorAll(".stop-btn").forEach((t=>{t.addEventListener("click",(()=>{o(t.getAttribute("id"))}))}))})(s)}))},s=document.getElementById("createANewCar"),i=document.getElementById("createColorCar");document.getElementById("createCarBtn").addEventListener("click",(()=>{const e=s.value,n=i.value;t("POST","http://localhost:3000/garage",{name:e,color:n}).then((t=>{l()})).catch((t=>{console.log(t)}))}));const d=document.querySelector("#race-btn"),u=[];d.addEventListener("click",(()=>{t("GET","http://127.0.0.1:3000/garage",null).then((e=>{!function(e){const n=[],a=[];function r(){e.forEach(((e,c)=>{const r=t("PATCH",`http://127.0.0.1:3000/engine?id=${e.id}&status=drive`,null,e.id).catch((t=>{o(t.message,!0,u[c])}));n.push(r),a.push(e.id)})),Promise.race(n).then((t=>{console.log(t)})).catch((t=>{console.log(t)}))}e.forEach((e=>{u.push(e.color);const o=t("PATCH",`http://127.0.0.1:3000/engine?id=${e.id}&status=started`,null);n.push(o),a.push(e.id)})),Promise.all(n).then((t=>{t.forEach(((t,e)=>{c(t,a[e],u[e])})),r()}))}(e)}))})),document.getElementById("reset-btn").addEventListener("click",(()=>{l()})),document.addEventListener("DOMContentLoaded",l)})();